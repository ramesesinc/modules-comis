import com.rameses.annotations.*;
import com.rameses.util.*;
import java.rmi.server.*;
import comis.facts.*;

public class ComisApplicationRuleService  {

	@Service("RuleExecutorService")
	def ruleSvc;

	@DataContext('vw_cemetery_resource')
	def em_view_resource;

	@ProxyMethod
	public def execute( app ) {
		def vwresource = em_view_resource.find([objid: app.resourceinfo.objid]).first();

		def facts = [];
		def resource = new CemeteryResource(vwresource);
		facts << resource;

		def cemetery = new Cemetery();
		cemetery.objid = vwresource.cemetery.objid;
		facts << cemetery;

		def bpa = new BurialPermitApplication(app);
		facts << bpa;

		def res = ruleSvc.execute( "burialpermitapplication", facts, null, null );
		app.leaseduration = bpa.leaseduration;
		app.renewable = bpa.renewable;
		app.fees = bpa.fees;
		app.amount = 0;
		app.amtpaid = 0;
		if (app.fees) {
			app.amount = app.fees.amount.sum();
		}
	}

}